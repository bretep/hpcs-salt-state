{% if https -%}

{%- if http -%}
<VirtualHost *:80>
    RewriteEngine On
    RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>
{% endif -%}

<VirtualHost *:443>
    ProxyPass / http://{{ server }}:{{ port }}/
    ProxyPassReverse / http://{{ server }}:{{ port }}/

    SSLEngine On
    SSLProxyEngine On
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
    SSLCertificateFile /etc/ssl/certs/{{ site }}.proxy.crt
    SSLCertificateKeyFile /etc/ssl/private/{{ site }}.proxy.key
</VirtualHost>

{%- elif http %}
<VirtualHost *:80>
    ProxyPass / http://{{ server }}:{{ port }}/
    ProxyPassReverse / http://{{ server }}:{{ port }}/
</VirtualHost>
{%- endif %}
